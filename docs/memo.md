# 备忘录

MEMO

## 配色

#8C1F22

##

综上讨论接下来（v0.6 大概两周时间）的我这边的工作有以下：

- 修改问答板块首页的展示方式（参考果壳问答 or WeCenter）

- 文章、问答、帖子等相关讨论回复通知，站内通知

- 评论的社交网站分享（这个实现思路是使用现在主站用的友言系统）
- 提问、回答、发帖相关UI的调整
- 问题、答案的子评论实现
- 整站的配色修改（尝试使用 bootstrap 的 less 的变量定制）

另外：

- 问答中问题的再修改这个估计会牵扯的流程比较多，这我再想想怎么实现。
- 附件和配图转移的思路就是将 wp-content/upload 一并拷贝过来。


等这些完成后，再上线新版测试，大家再一起以更新的版本讨论定夺，否则现在提的点太多，头绪又会有些乱。



## 新站上线事宜计划

Hi all,

新站写的差不多了：

测试地址在这里，http://207.226.142.159，墙内访问很快，大家可以试一下。

现在的内容除了文章其他都是填充的测试数据。

后台管理地址是 http://207.226.142.159/admin ，用户名 editor 密码 editor 。


新站内容方面只将老站的文章转移了过来，论坛的帖子没有转移。


对于老站论坛的用户是这样处理的：

- 用户登录
    - 查新库，有 id 则验证，返回是否通过
        - 没有通过，提示密码错误
        - 通过则登录
    - 没有 id 去老库找，验证
        - 通过，将老站的注册信息写入新库，登录
        - 没有通过，提示密码错误
    - 都没有找到id，提示去注册

经过这样的过程，即做到了数据上的分离，又继承了以前的用户信息。


具体的上线步骤如下：

- 对于老站：
    - 在当前的网站空间上再克隆一个老站，使用 old.cos.name 域名，关闭论坛注册与发帖。这个站作为归档站使用。
        - 因为 wp、bbpress 运行时与配置的域名有关联，所以需要:
            - 将数据库克隆一份（主站与论坛都要），开一个新的数据库账号
            - 将主站文件复制一份
            - 修改克隆后的与网址有关的配置（改为 old.cos.name）

    - 当前站，关闭论坛注册与发帖，其他一概不变，达到只要修改域名指向就回滚的目的

- 对于新站：
    - 将 new.cos.name 指向 207.226.142.159 （@谢大）

- 然后切换 cos.name 的指向


大家看看还有什么需要注意的地方？
感觉虽然新站还有很多疏漏，但是还是能尽快上线比较好，毕竟现在的整个新站可控度非常高，遇到实际的具体问题也能及时处理。


另外：

@谢大， dns 的解析服务我推荐使用 dnspod ，非常好用。




## 新站用户登录逻辑

- 用户登录逻辑
    - 查新库，有 id 则验证，返回是否通过
        - 没有通过，提示密码错误
        - 通过则登录
    - 没有 id 去老库找，验证
        - 通过，将信息写入新库，包括密码的新hash，登录
        - 没有通过，提示密码错误
    - 都没有找到id，提示去注册


## 旧站文章转移思路

- 用 xml 导出（wp自带工具）
- 写个脚本导入 mysql （单表，结构随意），考虑到 mysql 连接库的问题，用 php 实现，注意超时问题
    - 关键的字段
        - 发布时间
        - 内容
        - 摘要（用切割 <!-- more --> 的办法尝试？）


- 将库放上线，使用 phpmyadmin 导入主库

- 将以前的上传附件，转移到新站点，即 /wp-content/upload



## 输入组件

### 需要用 富文本 的内容实体

- Article
- Question
- Answer
- Post

### 编辑器（问题、评论）

pagedown + mathjax + pagedown-extra

### 后端 markdown parser

https://github.com/erusev/parsedown-extra


### 标签

tagmanager

### 头像上传

Jasny Bootstrap


### 前端验证

// @todo: 

http://reactiveraven.github.io/jqBootstrapValidation/

http://1000hz.github.io/bootstrap-validator/

### 代码高亮

highlightjs

### 日期选取

// @todo

### minify

https://github.com/ceesvanegmond/minify

考虑 fork 重写

- 缓存？